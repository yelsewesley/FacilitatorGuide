<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Facilitator's Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: "Soothing Sage" - A calm, professional palette with off-white, sage green, and slate gray. -->
    <!-- Application Structure Plan: A multi-tab single-page application following a facilitator's workflow. Added localStorage for data persistence, a "Clear Data" function, deeper stakeholder notes, and a structured risk planning module. This enhances the tool from a single-use worksheet to a reusable, strategic planning partner. -->
    <!-- Visualization & Content Choices: 1. Stakeholder Analysis: Bubble chart (Chart.js) with a numbered legend for export clarity. 2. Power Dynamics: Doughnut chart (Chart.js). 3. Data Persistence: All user-entered data (text fields, participants, risks) is saved to localStorage on every change and loaded on page start. 4. Risk Planning: A dynamic list allows users to add/remove potential session risks and their corresponding intervention plans. Justification: These choices create a robust, persistent, and strategically deeper tool. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            border-color: #34D399; /* emerald-400 */
            background-color: #ECFDF5; /* emerald-50 */
            color: #065F46; /* emerald-800 */
            font-weight: 600;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .form-input, .form-textarea, .form-select {
            transition: border-color 0.3s ease;
        }
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            border-color: #34D399;
            box-shadow: 0 0 0 2px #A7F3D0;
            outline: none;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 50vh;
        }
        #summary-preview {
            border: 1px solid #e2e8f0;
            padding: 2rem;
            border-radius: 0.5rem;
            background: white;
            white-space: pre-wrap; /* Ensures bullets render correctly */
        }
        .definition-text {
            font-size: 0.8rem;
            color: #64748b; /* slate-500 */
        }
        #stakeholder-legend {
            max-height: 400px;
            overflow-y: auto;
        }
        #save-indicator {
            transition: opacity 0.5s ease-in-out;
        }
        .traffic-light label {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
        }
        .traffic-light input[type="radio"]:checked + label {
            color: white;
            font-weight: 600;
        }
        /* Default Traffic Light (TA Effort): Low = Green, High = Red */
        #ta-effort-light input[value="Low"]:checked + label { background-color: #34D399; border-color: #10B981; }
        #ta-effort-light input[value="Medium"]:checked + label { background-color: #FBBF24; border-color: #F59E0B; }
        #ta-effort-light input[value="High"]:checked + label { background-color: #EF4444; border-color: #DC2626; }
        
        /* State Engagement Traffic Light: Low = Red, High = Green */
        #state-engagement-light input[value="Low"]:checked + label { background-color: #EF4444; border-color: #DC2626; }
        #state-engagement-light input[value="Medium"]:checked + label { background-color: #FBBF24; border-color: #F59E0B; }
        #state-engagement-light input[value="High"]:checked + label { background-color: #34D399; border-color: #10B981; }

        .traffic-light input[type="radio"] {
            display: none;
        }
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            #summary-preview, #summary-preview * {
                visibility: visible;
            }
            #summary-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                border: none;
                padding: 0;
            }
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">

        <header class="text-center mb-4">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-700">Interactive Facilitator's Guide</h1>
            <p class="mt-2 text-lg text-slate-500">Your dynamic worksheet for planning and reflection.</p>
            <div class="mt-4 h-8 flex items-center justify-center space-x-4">
                <span id="save-indicator" class="text-emerald-600 font-semibold opacity-0">Saved.</span>
                <div class="ml-auto flex items-center space-x-4">
                    <button onclick="toggleInstructionsModal(true)" class="text-sm text-sky-600 hover:text-sky-800 font-semibold">How to Collaborate</button>
                    <button onclick="document.getElementById('import-file').click()" class="text-sm text-sky-600 hover:text-sky-800 font-semibold">Import Plan</button>
                    <input type="file" id="import-file" class="hidden" accept=".json" onchange="importData(event)">
                    <button onclick="exportData()" class="text-sm text-sky-600 hover:text-sky-800 font-semibold">Export Plan</button>
                    <button onclick="clearAllData()" class="text-sm text-red-500 hover:text-red-700 font-semibold">Clear Plan</button>
                </div>
            </div>
        </header>

        <div class="w-full max-w-6xl mx-auto">
            <!-- Tabs Navigation -->
            <div id="main-nav" class="flex flex-wrap justify-center border-b border-slate-200 mb-8">
                <button class="tab-button active text-sm sm:text-base py-3 px-4 sm:px-6 border-b-2 border-transparent" onclick="showTab('foundation')">1. Foundation</button>
                <button class="tab-button text-sm sm:text-base py-3 px-4 sm:px-6 border-b-2 border-transparent" onclick="showTab('assessment')">2. Dynamics</button>
                <button class="tab-button text-sm sm:text-base py-3 px-4 sm:px-6 border-b-2 border-transparent" onclick="showTab('plan')">3. Plan</button>
                <button class="tab-button text-sm sm:text-base py-3 px-4 sm:px-6 border-b-2 border-transparent" onclick="showTab('checklist')">4. Pre-Check</button>
                <button class="tab-button text-sm sm:text-base py-3 px-4 sm:px-6 border-b-2 border-transparent" onclick="showTab('reflection')">5. Reflection</button>
                <button class="tab-button text-sm sm:text-base py-3 px-4 sm:px-6 border-b-2 border-transparent" onclick="showTab('summary')">6. Summary & Export</button>
            </div>

            <!-- Tab Content -->
            <div id="foundation" class="tab-content active">
                <div class="bg-white p-6 sm:p-8 rounded-lg shadow-sm max-w-5xl mx-auto">
                    <h2 class="text-2xl font-bold text-emerald-700 mb-1">Part 1: The Core Foundation</h2>
                    <p class="text-slate-500 mb-6">Define the high-level strategic context for this engagement. This tool is intended for planning critical or high-stakes sessions, not general TA meetings.</p>
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div><label for="facilitation-team" class="block text-sm font-medium text-slate-700 mb-1">Facilitation Team</label><input type="text" id="facilitation-team" class="form-input w-full p-2 border border-slate-300 rounded-md savable"></div>
                            <div>
                                <label for="working-state" class="block text-sm font-medium text-slate-700 mb-1">State / Territory</label>
                                <select id="working-state" class="form-select w-full p-2 border border-slate-300 rounded-md savable"></select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">State Engagement</label>
                                <div class="traffic-light flex space-x-2" id="state-engagement-light">
                                    <input type="radio" id="state-low" name="state-engagement" value="Low" class="savable"><label for="state-low">Low</label>
                                    <input type="radio" id="state-medium" name="state-engagement" value="Medium" class="savable"><label for="state-medium">Medium</label>
                                    <input type="radio" id="state-high" name="state-engagement" value="High" class="savable"><label for="state-high">High</label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">TA Effort</label>
                                <div class="traffic-light flex space-x-2" id="ta-effort-light">
                                    <input type="radio" id="ta-low" name="ta-effort" value="Low" class="savable"><label for="ta-low">Low</label>
                                    <input type="radio" id="ta-medium" name="ta-effort" value="Medium" class="savable"><label for="ta-medium">Medium</label>
                                    <input type="radio" id="ta-high" name="ta-effort" value="High" class="savable"><label for="ta-high">High</label>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div><label for="high-level-goals" class="block text-sm font-medium text-slate-700 mb-1">High-Level Goals</label><textarea id="high-level-goals" rows="3" class="form-textarea w-full p-2 border border-slate-300 rounded-md savable bulleted-textarea" placeholder="What are the overarching goals of this engagement?"></textarea></div>
                            <div><label for="high-level-barriers" class="block text-sm font-medium text-slate-700 mb-1">High-Level Barriers</label><textarea id="high-level-barriers" rows="3" class="form-textarea w-full p-2 border border-slate-300 rounded-md savable bulleted-textarea" placeholder="What are the known systemic or political barriers?"></textarea></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="assessment" class="tab-content">
                <div class="bg-white p-6 sm:p-8 rounded-lg shadow-sm max-w-5xl mx-auto">
                    <h2 class="text-2xl font-bold text-emerald-700 mb-1">Part 2: Dynamics Assessment</h2>
                    <p class="text-slate-500 mb-6">Analyze the human dynamics: stakeholder perspectives, power structures, and context.</p>
                    <div class="space-y-8">
                        <div>
                            <h3 class="text-xl font-semibold text-slate-800 mb-2">Power & Influence</h3>
                            <p class="text-slate-500 mb-4">Identify key participants, their source of influence, and your strategy to engage them. Adding a player here also adds them to the Stakeholder Analysis section below.</p>
                            <div class="space-y-4" id="power-players-container"></div>
                            <button onclick="addParticipant()" class="mt-2 text-md text-emerald-600 hover:text-emerald-800 font-bold">+ Add Player</button>
                            <div class="mt-4">
                               <h4 class="text-md font-semibold text-slate-700 mb-2">Power Distribution</h4>
                               <div class="chart-container" style="height:250px; max-height:30vh;"><canvas id="powerChart"></canvas></div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-slate-800 mb-2">Tension Temperature</h3>
                            <div class="space-y-2" id="tension-check">
                                <label class="flex items-start"><input type="radio" name="tension" value="Cool" class="form-radio h-4 w-4 text-emerald-600 mt-1 savable"><span class="ml-2"><strong>Cool:</strong><span class="definition-text ml-1">Trust is high, rapport is easy. Low risk of conflict.</span></span></label>
                                <label class="flex items-start"><input type="radio" name="tension" value="Warm" class="form-radio h-4 w-4 text-emerald-600 mt-1 savable"><span class="ml-2"><strong>Warm:</strong><span class="definition-text ml-1">Some differing opinions, professional respect exists. Productive debate is possible.</span></span></label>
                                <label class="flex items-start"><input type="radio" name="tension" value="Hot" class="form-radio h-4 w-4 text-emerald-600 mt-1 savable"><span class="ml-2"><strong>Hot:</strong><span class="definition-text ml-1">Known conflicts, low trust, high emotional stakes. Requires careful management.</span></span></label>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-slate-800 mb-2">Stakeholder Analysis</h3>
                            <p class="text-slate-500 mb-4">Rate each participant's interest and influence to map their position. The map legend helps identify who is who, especially for export.</p>
                            <div id="stakeholder-analysis-container" class="space-y-3 mb-6"></div>
                            <div class="grid md:grid-cols-2 gap-6 items-start">
                                <div class="chart-container"><canvas id="stakeholderChart"></canvas></div>
                                <div class="bg-slate-50 p-4 rounded-lg"><h4 class="font-semibold text-slate-700 mb-2">Map Legend</h4><div id="stakeholder-legend"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="plan" class="tab-content">
                 <div class="bg-white p-6 sm:p-8 rounded-lg shadow-sm max-w-5xl mx-auto">
                    <h2 class="text-2xl font-bold text-emerald-700 mb-1">Part 3: The Session Plan</h2>
                    <p class="text-slate-500 mb-6">Design the journey for a specific, high-stakes session. This plan should align with the high-level goals defined in the Foundation.</p>
                    <div class="space-y-8">
                        <div><label for="session-date" class="block text-sm font-medium text-slate-700 mb-1">Session Date</label><input type="date" id="session-date" class="form-input w-full p-2 border border-slate-300 rounded-md savable"></div>
                        <div>
                            <h3 class="text-lg font-semibold text-slate-800">Session Objectives</h3>
                            <div class="mt-2 space-y-2">
                                <div><label for="tangible-outcome" class="block text-sm font-medium text-slate-700 mb-1">Tangible Objective</label><input type="text" id="tangible-outcome" class="form-input w-full p-2 border border-slate-300 rounded-md savable" placeholder="e.g., a decision, a list of priorities, a draft plan"></div>
                                <div><label for="experiential-outcome" class="block text-sm font-medium text-slate-700 mb-1">Experiential Objective</label><input type="text" id="experiential-outcome" class="form-input w-full p-2 border border-slate-300 rounded-md savable" placeholder="e.g., participants feel heard, have clarity, are aligned"></div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-slate-800 mb-4">Process Flow (Agenda)</h3>
                            <div class="overflow-x-auto"><table class="min-w-full"><thead class="bg-slate-50"><tr><th class="px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase">Time</th><th class="px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase">Activity</th><th class="px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase">Purpose</th></tr></thead><tbody id="agenda-body" class="bg-white divide-y divide-slate-200"></tbody></table></div>
                            <button onclick="addAgendaRow()" class="mt-2 text-sm text-emerald-600 hover:text-emerald-800 font-semibold">+ Add Agenda Item</button>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-slate-800 mb-4">Risk & Contingency Planning</h3>
                            <p class="text-slate-500 mb-4">Proactively identify potential risks to the session and plan your response if they arise.</p>
                            <div class="space-y-4" id="risk-container"></div>
                            <button onclick="addRisk()" class="mt-2 text-md text-emerald-600 hover:text-emerald-800 font-bold">+ Add Risk</button>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-slate-800 mb-4">Facilitator's Inner Prep</h3>
                             <div class="space-y-4">
                                <div><label for="facilitator-role" class="block text-sm font-medium text-slate-700 mb-1">My primary role</label><input type="text" id="facilitator-role" class="form-input w-full p-2 border border-slate-300 rounded-md savable" placeholder="e.g., neutral guide, gentle challenger"></div>
                                <div><label for="facilitator-mantra" class="block text-sm font-medium text-slate-700 mb-1">My mantra</label><input type="text" id="facilitator-mantra" class="form-input w-full p-2 border border-slate-300 rounded-md savable" placeholder="e.g., Trust the group, Stay curious"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="checklist" class="tab-content">
                <div class="bg-white p-6 sm:p-8 rounded-lg shadow-sm max-w-5xl mx-auto">
                    <h2 class="text-2xl font-bold text-emerald-700 mb-1">Part 4: Final Pre-Flight Check</h2>
                    <p class="text-slate-500 mb-6">Run through this final checklist to ground yourself and ensure readiness.</p>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="space-y-4">
                             <h3 class="text-xl font-semibold text-slate-800">Checklist</h3>
                             <label class="flex items-start"><input type="checkbox" class="h-5 w-5 rounded text-emerald-500 mr-3 flex-shrink-0 mt-1"><span class="text-lg"><strong>Mindfulness:</strong><span class="block definition-text">Take a moment to center yourself and let go of your own agenda to better serve the group.</span></span></label>
                             <label class="flex items-start"><input type="checkbox" class="h-5 w-5 rounded text-emerald-500 mr-3 flex-shrink-0 mt-1"><span class="text-lg"><strong>Environment Ready:</strong><span class="block definition-text">Is the physical or virtual space set up as planned to support your process?</span></span></label>
                             <label class="flex items-start"><input type="checkbox" class="h-5 w-5 rounded text-emerald-500 mr-3 flex-shrink-0 mt-1"><span class="text-lg"><strong>Materials Ready:</strong><span class="block definition-text">Are all your tools (whiteboard, markers, links, etc.) ready and accessible?</span></span></label>
                             <label class="flex items-start"><input type="checkbox" class="h-5 w-5 rounded text-emerald-500 mr-3 flex-shrink-0 mt-1"><span class="text-lg"><strong>Technology Stable:</strong><span class="block definition-text">Is your connection stable? Does screen sharing work? Test all tech.</span></span></label>
                             <label class="flex items-start"><input type="checkbox" class="h-5 w-5 rounded text-emerald-500 mr-3 flex-shrink-0 mt-1"><span class="text-lg"><strong>Stance Reviewed:</strong><span class="block definition-text">Briefly re-read your role and mantra to set your intention for the session.</span></span></label>
                        </div>
                        <div class="bg-emerald-50 border-l-4 border-emerald-400 p-4 rounded-r-lg">
                            <h3 class="text-xl font-semibold text-emerald-800">Facilitator's Compass</h3>
                            <p class="mt-2 text-emerald-700">If I get lost, I will:</p>
                            <ul class="mt-2 list-decimal list-inside space-y-2 text-emerald-900"><li>Ask a Question</li><li>Use Silence</li><li>Name the Dynamic</li><li>Trust the Group</li></ul>
                        </div>
                    </div>
                </div>
            </div>

            <div id="reflection" class="tab-content">
                <div class="bg-white p-6 sm:p-8 rounded-lg shadow-sm max-w-5xl mx-auto">
                    <h2 class="text-2xl font-bold text-emerald-700 mb-1">Part 5: Post-Session Reflection</h2>
                    <p class="text-slate-500 mb-6">Capture your learnings within 24 hours to fuel your growth as a facilitator.</p>
                    <div class="space-y-6">
                        <div><label for="reflection-correct" class="block text-sm font-medium text-slate-700 mb-1">What I predicted correctly:</label><p class="definition-text mb-1">Which of your assumptions about group dynamics, tensions, or outcomes proved to be accurate?</p><textarea id="reflection-correct" rows="2" class="form-textarea w-full p-2 border border-slate-300 rounded-md savable bulleted-textarea"></textarea></div>
                        <div><label for="reflection-surprised" class="block text-sm font-medium text-slate-700 mb-1">What surprised me:</label><p class="definition-text mb-1">What happened that you didn't expect? What new information or behaviors emerged?</p><textarea id="reflection-surprised" rows="2" class="form-textarea w-full p-2 border border-slate-300 rounded-md savable bulleted-textarea"></textarea></div>
                        <div><label for="reflection-effective" class="block text-sm font-medium text-slate-700 mb-1">My most effective moment:</label><p class="definition-text mb-1">When did you feel you were most "in service" of the group's process? What specific action did you take?</p><textarea id="reflection-effective" rows="2" class="form-textarea w-full p-2 border border-slate-300 rounded-md savable bulleted-textarea"></textarea></div>
                         <div><label for="reflection-growth" class="block text-sm font-medium text-slate-700 mb-1">My growth edge for next time:</label><p class="definition-text mb-1">What is the one thing you would do differently in a similar situation? What skill do you want to develop?</p><textarea id="reflection-growth" rows="2" class="form-textarea w-full p-2 border border-slate-300 rounded-md savable bulleted-textarea"></textarea></div>
                    </div>
                </div>
            </div>

            <div id="summary" class="tab-content">
                <div class="grid lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-sm">
                        <h2 class="text-2xl font-bold text-emerald-700 mb-1">Part 6: Summary & Export</h2>
                        <p class="text-slate-500 mb-4">Select a preset or choose custom sections to include in your report, then print or save as a PDF.</p>
                        <div class="mb-4">
                            <label for="summary-preset" class="block text-sm font-medium text-slate-700 mb-1">Report Presets</label>
                            <select id="summary-preset" onchange="applySummaryPreset(this.value)" class="form-select w-full p-2 border border-slate-300 rounded-md">
                                <option value="custom">Custom Selection</option>
                                <option value="all-state">All-State Review</option>
                                <option value="agenda">Shareable Agenda</option>
                            </select>
                        </div>
                        <div id="summary-controls" class="space-y-3">
                            <label class="flex items-center"><input type="checkbox" data-section="foundation" checked class="h-4 w-4 rounded text-emerald-500 mr-2"> Foundation</label>
                            <label class="flex items-center"><input type="checkbox" data-section="power" checked class="h-4 w-4 rounded text-emerald-500 mr-2"> Power & Influence</label>
                            <label class="flex items-center"><input type="checkbox" data-section="tension" checked class="h-4 w-4 rounded text-emerald-500 mr-2"> Tension Temperature</label>
                            <label class="flex items-center"><input type="checkbox" data-section="stakeholders" checked class="h-4 w-4 rounded text-emerald-500 mr-2"> Stakeholder Analysis</label>
                            <label class="flex items-center"><input type="checkbox" data-section="plan" checked class="h-4 w-4 rounded text-emerald-500 mr-2"> Session Plan</label>
                            <label class="flex items-center"><input type="checkbox" data-section="risks" checked class="h-4 w-4 rounded text-emerald-500 mr-2"> Risk & Contingency Plan</label>
                            <label class="flex items-center"><input type="checkbox" data-section="facilitator-prep" checked class="h-4 w-4 rounded text-emerald-500 mr-2"> Facilitator's Inner Prep</label>
                            <label class="flex items-center"><input type="checkbox" data-section="reflection" checked class="h-4 w-4 rounded text-emerald-500 mr-2"> Reflection</label>
                        </div>
                        <button onclick="printSummary()" class="mt-6 w-full bg-emerald-500 text-white font-bold py-2 px-4 rounded-md hover:bg-emerald-600 transition-colors">Print / Export to PDF</button>
                    </div>
                    <div class="lg:col-span-2"><div id="summary-preview"></div></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Instructions Modal -->
    <div id="instructions-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0" onclick="toggleInstructionsModal(false)">
        <div class="modal-content bg-white rounded-lg shadow-xl p-6 sm:p-8 w-full max-w-2xl transform scale-95" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h2 class="text-2xl font-bold text-emerald-700">Collaborating on a Plan</h2>
                <button onclick="toggleInstructionsModal(false)" class="text-slate-400 hover:text-slate-600">&times;</button>
            </div>
            <div class="space-y-4 text-slate-700">
                <p>This tool allows your TA team to collaborate on a single facilitation plan by passing a small data file back and forth. Here’s the recommended workflow:</p>
                <div class="space-y-3">
                    <div>
                        <h3 class="font-semibold text-slate-800">Step 1: Start & Save</h3>
                        <p class="text-sm">One person starts the plan. As they fill out the form, their work is automatically saved to their local browser. This becomes the "master copy".</p>
                    </div>
                    <div>
                        <h3 class="font-semibold text-slate-800">Step 2: Export Plan Data</h3>
                        <p class="text-sm">When ready to share, click the <strong>Export Plan</strong> button. This will save a small JSON file based on the state and session date you entered (e.g., `Arizona-2025-08-15-FacilitatorPlan.json`) to your computer.</p>
                    </div>
                    <div>
                        <h3 class="font-semibold text-slate-800">Step 3: Share the File</h3>
                        <p class="text-sm">Send this small <code>.json</code> file to your TA partner or team via email, Teams, or any other method.</p>
                    </div>
                    <div>
                        <h3 class="font-semibold text-slate-800">Step 4: Import & Continue</h3>
                        <p class="text-sm">Your partner opens their blank version of this tool, clicks <strong>Import Plan</strong>, and selects the file you sent. The entire worksheet will instantly populate with the in-progress plan.</p>
                    </div>
                </div>
                <p class="pt-4 border-t text-sm text-slate-600"><strong>Key Point:</strong> This process allows the "master copy" of the plan to be passed between team members. After the session, anyone with the latest file can import it, fill out the <strong>Reflection</strong> tab, and export the final PDF summary.</p>
            </div>
            <div class="mt-6 text-right">
                <button onclick="toggleInstructionsModal(false)" class="bg-emerald-500 text-white font-bold py-2 px-4 rounded-md hover:bg-emerald-600 transition-colors">Got it</button>
            </div>
        </div>
    </div>


    <script>
        let stakeholderChart, powerChart;
        let participants = [];
        let risks = [];
        let agenda = [];
        let saveTimeout;

        const STORAGE_KEY = 'facilitatorGuideData_v6';

        const statesAndTerritories = [
            "Alabama", "Alaska", "American Samoa", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "District of Columbia", "Florida", "Georgia", "Guam", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico", "New York", "North Carolina", "North Dakota", "Northern Mariana Islands", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Puerto Rico", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "U.S. Virgin Islands", "Utah", "Vermont", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming"
        ];

        function populateStatesDropdown() {
            const select = document.getElementById('working-state');
            select.innerHTML = '<option value="">Select a State/Territory...</option>';
            statesAndTerritories.forEach(state => {
                const option = document.createElement('option');
                option.value = state;
                option.textContent = state;
                select.appendChild(option);
            });
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.tab-button').forEach(b => {
                b.classList.remove('active');
                if (b.getAttribute('onclick') === `showTab('${tabId}')`) b.classList.add('active');
            });
            if (tabId === 'summary') generateSummary();
        }

        function toggleInstructionsModal(show) {
            const modal = document.getElementById('instructions-modal');
            const content = modal.querySelector('.modal-content');
            if (show) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    content.classList.remove('scale-95');
                }, 10);
            } else {
                modal.classList.add('opacity-0');
                content.classList.add('scale-95');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }
        }

        function showSaveIndicator() {
            const indicator = document.getElementById('save-indicator');
            indicator.classList.remove('opacity-0');
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                indicator.classList.add('opacity-0');
            }, 1500);
        }

        function getPlanDataAsObject() {
            const simpleInputs = {};
            document.querySelectorAll('.savable').forEach(input => {
                if (input.type === 'radio') {
                    if (input.checked) simpleInputs[input.name] = input.value;
                } else {
                    simpleInputs[input.id] = input.value;
                }
            });

            const agendaData = [];
            document.querySelectorAll('#agenda-body tr').forEach(row => {
                const inputs = row.querySelectorAll('input');
                agendaData.push({
                    time: inputs[0].value,
                    activity: inputs[1].value,
                    purpose: inputs[2].value
                });
            });

            return {
                participants,
                risks,
                agenda: agendaData,
                simpleInputs
            };
        }

        function saveData() {
            const data = getPlanDataAsObject();
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            showSaveIndicator();
        }

        function applyDataToState(data) {
            participants = data.participants || [];
            risks = data.risks || [];
            agenda = data.agenda || [];

            if (data.simpleInputs) {
                Object.keys(data.simpleInputs).forEach(key => {
                    const input = document.getElementById(key);
                    if (input) {
                        input.value = data.simpleInputs[key];
                    } 
                    const radio = document.querySelector(`input[name="${key}"][value="${data.simpleInputs[key]}"]`);
                    if (radio) radio.checked = true;
                });
            }
        }

        function loadDataFromStorage() {
            const dataString = localStorage.getItem(STORAGE_KEY);
            if (!dataString) return;
            try {
                const data = JSON.parse(dataString);
                applyDataToState(data);
            } catch(e) {
                console.error("Could not parse localStorage data:", e);
            }
        }
        
        function clearAllData() {
            if (confirm('Are you sure you want to clear all data for this plan? This action cannot be undone.')) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        function exportData() {
            const data = getPlanDataAsObject();
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], {type: "application/json"});
            
            const state = document.getElementById('working-state').value.replace(/\s+/g, '-') || 'Untitled';
            const date = document.getElementById('session-date').value || new Date().toISOString().split('T')[0];
            const filename = `${state}-${date}-FacilitatorPlan.json`;

            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (confirm('This will overwrite your current plan saved in this browser. Are you sure you want to continue?')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        applyDataToState(data);
                        renderAll();
                        saveData();
                        alert('Plan imported successfully!');
                    } catch (error) {
                        alert('Error: Could not parse the file. Please ensure it is a valid plan file.');
                        console.error("Import error:", error);
                    }
                };
                reader.readAsText(file);
            }
            event.target.value = '';
        }

        function renderAll() {
            renderPowerPlayers();
            renderStakeholderAnalysis();
            renderStakeholderLegend();
            renderRisks();
            renderAgenda();
            updatePowerChart();
            updateStakeholderChart();
        }
        
        function renderPowerPlayers() {
            const container = document.getElementById('power-players-container');
            container.innerHTML = '';
            participants.forEach((player, index) => {
                const div = document.createElement('div');
                div.className = 'p-3 bg-slate-50 rounded-lg border border-slate-200';
                const strategyValue = player.strategy || '';
                const roleValue = player.role || '';
                div.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2 mb-2">
                        <input type="text" value="${player.name}" oninput="updateParticipant(${index}, 'name', this.value)" placeholder="Participant Name" class="form-input p-2 border border-slate-300 rounded-md">
                        <input type="text" value="${roleValue}" oninput="updateParticipant(${index}, 'role', this.value)" placeholder="Role" class="form-input p-2 border border-slate-300 rounded-md">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2 items-center">
                        <select onchange="updateParticipant(${index}, 'powerType', this.value)" class="form-select p-2 border border-slate-300 rounded-md w-full">
                            <option value="" ${player.powerType === '' ? 'selected' : ''}>Select Power Type</option>
                            <option value="Position" ${player.powerType === 'Position' ? 'selected' : ''}>Position</option>
                            <option value="Expert" ${player.powerType === 'Expert' ? 'selected' : ''}>Expert</option>
                            <option value="Relationship" ${player.powerType === 'Relationship' ? 'selected' : ''}>Relationship</option>
                        </select>
                        <button onclick="removeParticipant(${index})" class="text-red-500 hover:text-red-700 text-sm justify-self-start md:justify-self-end">Remove</button>
                    </div>
                    <div id="power-def-${index}" class="mt-2 pl-1 definition-text"></div>
                    <div class="mt-2">
                        <label class="text-sm font-medium text-slate-600">Engagement Strategy / Key Notes</label>
                        <textarea oninput="updateParticipant(${index}, 'strategy', this.value)" class="form-textarea w-full mt-1 p-2 border border-slate-300 rounded-md text-sm" rows="2">${strategyValue}</textarea>
                    </div>
                `;
                container.appendChild(div);
                updatePowerDefinition(index);
            });
        }
        
        function renderStakeholderAnalysis() {
            const container = document.getElementById('stakeholder-analysis-container');
            container.innerHTML = '';
             if (participants.length === 0) {
                container.innerHTML = `<p class="text-slate-500 text-sm">Add participants in the "Power & Influence" section above to begin stakeholder analysis.</p>`;
                return;
            }
            participants.forEach((player, index) => {
                const div = document.createElement('div');
                const interestValue = player.interest || '';
                const influenceValue = player.influence || '';
                div.className = 'grid grid-cols-3 gap-4 items-center p-2 rounded-md even:bg-slate-50';
                div.innerHTML = `
                    <span class="font-semibold text-slate-700">${player.name || `Participant ${index + 1}`}</span>
                    <input type="number" value="${interestValue}" oninput="updateParticipant(${index}, 'interest', this.value)" placeholder="Interest (1-10)" min="1" max="10" class="form-input p-2 border border-slate-300 rounded-md w-full">
                    <input type="number" value="${influenceValue}" oninput="updateParticipant(${index}, 'influence', this.value)" placeholder="Influence (1-10)" min="1" max="10" class="form-input p-2 border border-slate-300 rounded-md w-full">
                `;
                container.appendChild(div);
            });
        }

        function renderStakeholderLegend() {
            const container = document.getElementById('stakeholder-legend');
            if (participants.length === 0) {
                container.innerHTML = `<p class="text-slate-500 text-sm">Participants will be listed here as you add them.</p>`; return;
            }
            let html = '<ul class="space-y-2 text-sm">';
            participants.forEach((p, index) => {
                html += `<li><strong>${index + 1}. ${p.name || 'Unnamed'}:</strong> (Inf: ${p.influence || '?'}, Int: ${p.interest || '?'})</li>`;
            });
            html += '</ul>';
            container.innerHTML = html;
        }

        function renderRisks() {
            const container = document.getElementById('risk-container');
            container.innerHTML = '';
            risks.forEach((risk, index) => {
                const div = document.createElement('div');
                const descriptionValue = risk.description || '';
                const interventionValue = risk.intervention || '';
                div.className = 'p-3 bg-slate-50 rounded-lg border border-slate-200';
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <label class="text-sm font-medium text-slate-600">Risk #${index + 1}</label>
                        <button onclick="removeRisk(${index})" class="text-red-500 hover:text-red-700 text-sm">Remove</button>
                    </div>
                    <textarea oninput="updateRisk(${index}, 'description', this.value)" class="form-textarea w-full mt-1 p-2 border border-slate-300 rounded-md text-sm" rows="2" placeholder="Describe the potential risk...">${descriptionValue}</textarea>
                    <label class="text-sm font-medium text-slate-600 mt-2 block">Contingency Plan / Intervention</label>
                    <textarea oninput="updateRisk(${index}, 'intervention', this.value)" class="form-textarea w-full mt-1 p-2 border border-slate-300 rounded-md text-sm" rows="2" placeholder="How will you respond if this happens?">${interventionValue}</textarea>
                `;
                container.appendChild(div);
            });
        }

        function renderAgenda() {
            const tbody = document.getElementById('agenda-body');
            tbody.innerHTML = '';
            agenda.forEach((item, index) => {
                const newRow = document.createElement('tr');
                const timeValue = item.time || '';
                const activityValue = item.activity || '';
                const purposeValue = item.purpose || '';
                newRow.innerHTML = `<td class="px-4 py-2"><input type="time" value="${timeValue}" oninput="updateAgenda(${index}, 'time', this.value)" class="form-input w-32 p-1 border border-slate-300 rounded-md"></td><td class="px-4 py-2"><input type="text" value="${activityValue}" oninput="updateAgenda(${index}, 'activity', this.value)" class="form-input w-full p-1 border border-slate-300 rounded-md"></td><td class="px-4 py-2"><input type="text" value="${purposeValue}" oninput="updateAgenda(${index}, 'purpose', this.value)" class="form-input w-full p-1 border border-slate-300 rounded-md"></td>`;
                tbody.appendChild(newRow);
            });
        }
        
        function updatePowerDefinition(index) {
            const player = participants[index];
            const defEl = document.getElementById(`power-def-${index}`);
            let defText = '';
            switch(player.powerType) {
                case 'Position': defText = 'Influence from formal role, title, or authority (e.g., CEO, Director).'; break;
                case 'Expert': defText = 'Influence from knowledge, skills, or experience (e.g., Lead Engineer, Subject Matter Expert).'; break;
                case 'Relationship': defText = 'Influence from connections, trust, and social networks (e.g., respected long-timer, well-connected colleague).'; break;
            }
            if (defEl) defEl.textContent = defText;
        }

        function addParticipant() {
            if (participants.length < 20) {
                participants.push({ name: '', role: '', powerType: '', interest: '', influence: '', strategy: '' });
                renderAll();
                saveData();
            }
        }

        function removeParticipant(index) {
            participants.splice(index, 1);
            renderAll();
            saveData();
        }

        function updateParticipant(index, key, value) {
            participants[index][key] = value;
            if (key === 'name' || key === 'role') {
                renderStakeholderAnalysis();
                renderStakeholderLegend();
                updateStakeholderChart();
            } else if (key === 'powerType') {
                updatePowerDefinition(index);
                updatePowerChart();
            } else if (key === 'interest' || key === 'influence') {
                renderStakeholderLegend();
                updateStakeholderChart();
            }
            saveData();
        }

        function addRisk() {
            risks.push({ description: '', intervention: '' });
            renderRisks();
            saveData();
        }

        function removeRisk(index) {
            risks.splice(index, 1);
            renderRisks();
            saveData();
        }

        function updateRisk(index, key, value) {
            risks[index][key] = value;
            saveData();
        }

        function addAgendaRow() {
            agenda.push({ time: '', activity: '', purpose: '' });
            renderAgenda();
            saveData();
        }

        function updateAgenda(index, key, value) {
            agenda[index][key] = value;
            saveData();
        }

        function updatePowerChart() {
            const counts = { 'Position': 0, 'Expert': 0, 'Relationship': 0 };
            participants.forEach(p => { if (p.powerType) counts[p.powerType]++; });
            if(powerChart) {
                powerChart.data.datasets[0].data = Object.values(counts);
                powerChart.update('none');
            }
        }

        function updateStakeholderChart() {
            if (!stakeholderChart) return;
            stakeholderChart.data.datasets[0].data = participants.map((p, index) => ({
                x: p.influence, y: p.interest, r: 10, label: `${index + 1}. ${p.name}`
            }));
            stakeholderChart.update('none');
        }

        function applySummaryPreset(preset) {
            const controls = document.querySelectorAll('#summary-controls input[type="checkbox"]');
            const presets = {
                'custom': null, // Do nothing for custom
                'all-state': ['foundation', 'power', 'tension', 'stakeholders', 'risks'],
                'agenda': ['foundation', 'power', 'plan']
            };

            const sectionsToShow = presets[preset];
            if (!sectionsToShow) return;

            controls.forEach(cb => {
                cb.checked = sectionsToShow.includes(cb.dataset.section);
            });
            generateSummary();
        }

        const getRadioVal = (name) => {
            const checked = document.querySelector(`input[name="${name}"]:checked`);
            return checked ? checked.value : 'Not set';
        };
        
        function getTrafficLightColor(name) {
            const value = getRadioVal(name);
            if (name === 'state-engagement') {
                if (value === 'Low') return 'bg-red-500';
                if (value === 'Medium') return 'bg-yellow-400';
                if (value === 'High') return 'bg-green-500';
            } else if (name === 'ta-effort') {
                if (value === 'Low') return 'bg-green-500';
                if (value === 'Medium') return 'bg-yellow-400';
                if (value === 'High') return 'bg-red-500';
            }
            return 'bg-slate-200';
        }

        function generateSummary() {
            const controls = document.querySelectorAll('#summary-controls input[type="checkbox"]');
            const preview = document.getElementById('summary-preview');
            let html = '<div class="space-y-8">';
            const getVal = (id) => document.getElementById(id).value;
            
            const getRadioDefinition = (name) => {
                const checked = document.querySelector(`input[name="${name}"]:checked`);
                if (!checked) return '';
                return checked.parentElement.querySelector('.definition-text').textContent;
            };
            const escapeHtml = (unsafe) => unsafe ? unsafe.toString().replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;") : '';

            controls.forEach(control => {
                if (control.checked) {
                    const section = control.dataset.section;
                    html += '<section>';
                    switch (section) {
                        case 'foundation':
                            html += '<h2 class="text-2xl font-bold text-slate-700 border-b pb-2 mb-4">Foundation</h2>';
                            html += `<p><strong>Team:</strong> ${escapeHtml(getVal('facilitation-team'))}</p>`;
                            html += `<p><strong>State:</strong> ${escapeHtml(getVal('working-state'))}</p>`;
                            html += `<div class="grid grid-cols-2 gap-4 mt-4">`;
                            html += `<div><p><strong>State Engagement:</strong> <span class="inline-block w-4 h-4 rounded-full mr-2 ${getTrafficLightColor('state-engagement')}"></span>${escapeHtml(getRadioVal('state-engagement'))}</p></div>`;
                            html += `<div><p><strong>TA Effort:</strong> <span class="inline-block w-4 h-4 rounded-full mr-2 ${getTrafficLightColor('ta-effort')}"></span>${escapeHtml(getRadioVal('ta-effort'))}</p></div>`;
                            html += `</div>`;
                            html += `<h3 class="text-lg font-semibold mt-4">High-Level Goals</h3><p>${escapeHtml(getVal('high-level-goals'))}</p>`;
                            html += `<h3 class="text-lg font-semibold mt-4">High-Level Barriers</h3><p>${escapeHtml(getVal('high-level-barriers'))}</p>`;
                            break;
                        case 'power':
                            html += '<h2 class="text-2xl font-bold text-slate-700 border-b pb-2 mb-4">Power & Influence</h2>';
                            participants.filter(p => p.name).forEach(p => {
                                html += `<div class="mb-2"><p><strong>${escapeHtml(p.name)} (${escapeHtml(p.role)}):</strong> ${escapeHtml(p.powerType)}</p>`;
                                if(p.strategy) html += `<p class="text-sm pl-4"><em>Strategy:</em> ${escapeHtml(p.strategy)}</p></div>`;
                            });
                            if (powerChart) html += `<img src="${powerChart.toBase64Image()}" class="mt-4 mx-auto" style="max-width: 400px;"/>`;
                            break;
                        case 'tension':
                             const tensionValue = getRadioVal('tension');
                             const tensionDef = getRadioDefinition('tension');
                            html += `<h2 class="text-2xl font-bold text-slate-700 border-b pb-2 mb-4">Tension Temperature</h2><p><strong>${escapeHtml(tensionValue)}:</strong> ${escapeHtml(tensionDef)}</p>`;
                            break;
                        case 'stakeholders':
                            html += '<h2 class="text-2xl font-bold text-slate-700 border-b pb-2 mb-4">Stakeholder Analysis</h2>';
                            html += '<div style="display:flex; gap: 1rem; align-items: flex-start;">';
                            if (stakeholderChart) html += `<img src="${stakeholderChart.toBase64Image()}" style="max-width: 400px; flex-shrink:0;"/>`;
                            html += '<div><h4>Legend</h4>' + document.getElementById('stakeholder-legend').innerHTML + '</div></div>';
                            break;
                        case 'plan':
                            html += '<h2 class="text-2xl font-bold text-slate-700 border-b pb-2 mb-4">Session Plan</h2>';
                            html += `<p><strong>Session Date:</strong> ${escapeHtml(getVal('session-date'))}</p>`;
                            html += `<h3 class="text-lg font-semibold mt-4">Session Objectives</h3>`;
                            html += `<p><strong>Tangible:</strong> ${escapeHtml(getVal('tangible-outcome'))}</p>`;
                            html += `<p><strong>Experiential:</strong> ${escapeHtml(getVal('experiential-outcome'))}</p>`;
                            html += '<h3 class="text-lg font-semibold mt-4 mb-2">Agenda</h3>';
                            html += '<table class="w-full text-sm"><thead><tr class="bg-slate-100"><th class="p-2 text-left">Time</th><th class="p-2 text-left">Activity</th><th class="p-2 text-left">Purpose</th></tr></thead><tbody>';
                            agenda.forEach(item => {
                                html += `<tr><td class="p-2 border-t">${escapeHtml(item.time)}</td><td class="p-2 border-t">${escapeHtml(item.activity)}</td><td class="p-2 border-t">${escapeHtml(item.purpose)}</td></tr>`;
                            });
                            html += '</tbody></table>';
                            break;
                        case 'risks':
                            html += '<h2 class="text-2xl font-bold text-slate-700 border-b pb-2 mb-4">Risk & Contingency Plan</h2>';
                            risks.filter(r => r.description).forEach(r => {
                                html += `<div class="mb-2"><p><strong>Risk:</strong> ${escapeHtml(r.description)}</p><p class="text-sm pl-4"><em>Plan:</em> ${escapeHtml(r.intervention)}</p></div>`;
                            });
                            break;
                        case 'facilitator-prep':
                            html += '<h2 class="text-2xl font-bold text-slate-700 border-b pb-2 mb-4">Facilitator\'s Inner Prep</h2>';
                            html += `<p><strong>Role:</strong> ${escapeHtml(getVal('facilitator-role'))}</p><p><strong>Mantra:</strong> ${escapeHtml(getVal('facilitator-mantra'))}</p>`;
                            break;
                        case 'reflection':
                            html += '<h2 class="text-2xl font-bold text-slate-700 border-b pb-2 mb-4">Post-Session Reflection</h2>';
                            html += `<p><strong>Predicted Correctly:</strong> ${escapeHtml(getVal('reflection-correct'))}</p>`;
                            html += `<p><strong>Surprises:</strong> ${escapeHtml(getVal('reflection-surprised'))}</p>`;
                            html += `<p><strong>Most Effective Moment:</strong> ${escapeHtml(getVal('reflection-effective'))}</p>`;
                            html += `<p><strong>Growth Edge:</strong> ${escapeHtml(getVal('reflection-growth'))}</p>`;
                            break;
                    }
                    html += '</section>';
                }
            });
            html += '</div>';
            preview.innerHTML = html;
        }

        function printSummary() { window.print(); }
        
        function handleBulletPoints(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const target = event.target;
                const start = target.selectionStart;
                const end = target.selectionEnd;
                const value = target.value;
                const textToInsert = '\n• ';
                target.value = value.substring(0, start) + textToInsert + value.substring(end);
                target.selectionStart = target.selectionEnd = start + textToInsert.length;
                target.dispatchEvent(new Event('input', { bubbles: true }));
            }
        }
        
        function initializeBulletedTextareas() {
            document.querySelectorAll('.bulleted-textarea').forEach(textarea => {
                if (textarea.value === '') {
                    textarea.value = '• ';
                }
            });
        }

        window.onload = function() {
            populateStatesDropdown();
            const powerCtx = document.getElementById('powerChart').getContext('2d');
            powerChart = new Chart(powerCtx, { type: 'doughnut', data: { labels: ['Position', 'Expert', 'Relationship'], datasets: [{ data: [0, 0, 0], backgroundColor: ['#6366F1', '#34D399', '#FBBF24'], hoverOffset: 4 }] }, options: { responsive: true, maintainAspectRatio: false, animation: false, plugins: { legend: { position: 'top' }}}});
            const stakeholderCtx = document.getElementById('stakeholderChart').getContext('2d');
            stakeholderChart = new Chart(stakeholderCtx, { type: 'bubble', data: { datasets: [{ label: 'Stakeholders', data: [], backgroundColor: 'rgba(52, 211, 153, 0.5)', borderColor: 'rgb(20, 83, 45)', borderWidth: 1, }] }, options: { responsive: true, maintainAspectRatio: false, animation: false, scales: { x: { title: { display: true, text: 'Influence (1-10)' }, min: -0.5, max: 10.5, }, y: { title: { display: true, text: 'Interest (1-10)' }, min: -0.5, max: 10.5 }}, plugins: { legend: { display: false }, tooltip: { callbacks: { label: (c) => c.raw.label || '' }}, title: { display: true, text: 'Stakeholder Influence vs. Interest' }}}});
            
            loadDataFromStorage();
            renderAll();
            initializeBulletedTextareas();
            
            document.querySelectorAll('.savable').forEach(input => {
                input.addEventListener('input', saveData);
                if(input.type === 'radio' || input.tagName.toLowerCase() === 'select') {
                    input.addEventListener('change', saveData);
                }
            });

            document.querySelectorAll('#summary-controls input').forEach(c => {
                c.addEventListener('change', () => {
                    document.getElementById('summary-preset').value = 'custom';
                    generateSummary();
                });
            });

            document.querySelectorAll('.bulleted-textarea').forEach(textarea => {
                textarea.addEventListener('keydown', handleBulletPoints);
            });
        };
    </script>

</body>
</html>
